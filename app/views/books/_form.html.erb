<%= f.input :title, :label => "Titel", 
	:input_html => {:class => "span5"} %>
<div id="similar_books" style="display:none"></div>
<%= f.input :year, :label => "Erscheinungsjahr", :input_html => { :style => "width:50px", :maxlength => "4" }%>
<%= f.input :publisher, :label => "Herausgebende Institution / Verlag", 
	:input_html => {:class => "span5"} %>

<!-- Formats -->
<label for="formats">Publikationsart(en) auswählen</label>
<% Format.all(:order => "name ASC").each_with_index do |fm, i| -%>
	<% if i%3==0 -%>
		<div style="float:left;height:80px;margin-right:15px">
	<% end -%>
	<%= f.simple_fields_for fm do |ff| -%>
		<%= check_box_tag "book[format_ids][]",fm.id, book.formats.include?(fm) %>&#160;<%= fm.name %><br />
	<% end -%>
	<% if i+1 == Format.all.size || (i+1)%3==0 -%>
		</div>
	<% end -%>
<% end -%>

<!-- Tags -->
<div style="clear:left">
<label for="book_nested_tag_ids">Schlagwort auswählen</label>
	<%= partial "shared/tag_selection" %>
	<%# Set selected tag on client because partial is cached %>
	<%= hidden_field_tag "tag_id",book.nested_tags.size > 0 ? book.nested_tags[0].id : 0%>
	<script type="text/javascript" charset="utf-8">
		document.observe('dom:loaded',function(event) {
			$('book_nested_tag_ids').childElements().each(function(o) {
			  if (parseInt(o.value) == parseInt($F('tag_id'))) {
					o.selected = "selected";
				}
				else {
					o.selected = "";
				}
			});
		});
	</script>
</div>

<!-- Authors -->
<div class="section border">
	<h2>Autoren</h2>
	<div class="row">
		<div class="span0"><%= f.check_box "publisher_is_author", {}, @book.publisher_is_author %></div>
		<div class="span5"><%= f.label :publisher_is_author, "Autor entspricht Herausgeber / Verlag" %></div>
	</div>
	<div id="authors">
	<%= f.simple_fields_for :authors do |builder| %>
		<%= partial "authors/author_fields", :f => builder %>
	<% end %>
	</div>
	<div id="new_author_fields" style="display: none">
		<%= add_new_author_fields(f, :authors) %>
	</div>
	<div><%= link_to_function("Neuen Autor hinzufügen", "addNewAuthor(this)", {:class => "btn btn-primary"} ) %></div>
</div>

<!-- Location -->
<div class="section border">
	<%= f.input :abstract, :label => "Zusammenfassung / Abstract", :input_html => {:style => "width: 400px;", :rows => 10} %>
	<%= f.input :location, :label => "Aktueller Standort", :input_html => {:style => "width: 400px;"	, :rows => 10} %>
</div>

<!-- Upload -->
<div class="section border">
	<% if book.document.file? %>
	<h4>Vorhandene Datei ersetzen oder löschen</h4>
		<div style="float:left;margin-right:10px"><%= image_tag("icons/file_pdf.png") %></div>
		<div>
			<%= book.document.original_filename %>&#160;
			<% if admin_signed_in? -%>
				<%= link_to image_tag("icons/bin_empty.png"), destroy_document_book_path(book), 
					{:title => "Anhang löschen", 
					:confirm => "Willst Du diesen Anhang wirklich löschen?" } 
					%>
			<% end %>
		</div>
	<% else %>
		<h4>Datei anhängen</h4>
	<% end %>
	<%= f.file_field :document, :label => "Datei auswählen ...", :style => "height:24px" %>
</div>