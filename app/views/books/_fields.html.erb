<div class="section">
	<%= f.text_field :title, {:label => "Titel", :class => "large"} %>
	<div id="similar_books" style="display:none"></div>
	<%= f.text_field :year, {:label => "Erscheinungsjahr", :size => 4} %>
	<%= f.text_field :publisher, {:label => "Herausgebende Institution / Verlag", :class => "large"} %>
	<label for="formats">Publikationsart(en) auswählen</label><br />
	<% Format.all(:order => "name ASC").each_with_index do |fm,i| -%>
		<% if i%3==0 -%>
			<div style="float:left;height:80px;margin-right:15px">
		<% end -%>
		<% f.simple_fields_for fm do |ff| -%>
			<%= check_box_tag "book[format_ids][]",fm.id, @book.formats.include?(fm) %>&#160;<%= fm.name %><br />
		<% end -%>
		<% if i+1 == Format.all.size || (i+1)%3==0 -%>
			</div>
		<% end -%>
	<% end -%>
</div>
<div class="section" style="clear:left;">
	<div class="fields">
	 	<label for="book_nested_tag_ids">Schlagwort auswählen</label><br />
		<%= partial "shared/tag_selection"%>
		<%# Set selected tag on client because partial is cached %>
		<%= hidden_field_tag "tag_id",book.nested_tags.size > 0 ? book.nested_tags[0].id : 0%>
		<script type="text/javascript" charset="utf-8">
			document.observe('dom:loaded',function(event) {
				$('book_nested_tag_ids').childElements().each(function(o) {
				  if (parseInt(o.value) == parseInt($F('tag_id'))) {
						o.selected = "selected";
					}
					else {
						o.selected = "";
					}
				});
			});
		</script>
	</div>
</div>
<div class="section border">
	<div id="authors">
		<h4>Autoren</h4>
		<%= f.check_box :publisher_is_author, {:label => "Autor entspricht Herausgeber / Verlag"} %>
		<% if (params[:action].eql?("edit") || params[:action].eql?("update")) && book.authors.size > 0 -%>
			<% i = 0 
				for author in book.authors -%>
				<% simple_fields_for("book[authors][#{author.id}]",author) do |formBuilder| -%>
					<%= partial "authors/fields",:f=>formBuilder,:book=> book, :author=>author, :i=>i+=1 %>
				<% end -%>
			<% end -%>
		<% else -%>
			<% simple_fields_for("book[authors][1]",author) do |formBuilder| -%>
				<%= partial "authors/fields",:f=>formBuilder, :book => book, :author=>Author.new %>
			<% end -%>
		<% end -%>
	</div>
	<% if @book.errors.on(:authors) %>
	<div class="fields-with-error"><label class="message warn" for="book_[authors]">Bitte gebe mindestens einen Autor an.</label></div>
	<% end %>
	<div style="margin-top:10px"><%= link_to "Neuen Autor hinzufügen", "javascript:;", {:id => "add_author_button", :class=>"button large"} %></div>
</div>
<div class="clear"></div>
<div class="section border">
	<%= f.text_area :abstract, {:label => "Zusammenfassung / Abstract", :cols => 60, :rows => 6} %>
	<%= f.text_area :location, {:label => "Aktueller Standort", :cols => 60, :rows => 6} %>
</div>
<div class="section border">
	<% if book.document.file? %>
	<h4>Vorhandene Datei ersetzen oder löschen</h4>
		<div style="float:left;margin-right:10px"><%= image_tag("icons/file_pdf.png") %></div>
		<div>
			<%= book.document.original_filename %>&#160;
			<% if current_user.has_role?(:admin) -%><%= link_to image_tag("icons/bin_empty.png"),destroy_document_book_path(book), :method => :delete, :title => "Anhang löschen", :confirm => "Willst Du diesen Anhang wirklich löschen?"%><% end %>
		</div>
	<% else %>
		<h4>Datei anhängen</h4>
	<% end %>
	<%= f.file_field :document, :label => "Datei auswählen ...", :style => "height:24px" %>
</div>
